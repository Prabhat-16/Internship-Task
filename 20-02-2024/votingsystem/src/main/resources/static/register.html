<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <title>VoteSecure ‚Äî Register</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --primary: #6366f1;
      --primary-light: #818cf8;
      --primary-dark: #4f46e5;
      --accent: #06b6d4;
      --bg-deep: #0a0b1e;
      --border: rgba(255,255,255,0.1);
      --text: #f1f5f9;
      --text-muted: #94a3b8;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-deep);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 20% 10%, rgba(99,102,241,0.25) 0%, transparent 60%),
        radial-gradient(ellipse 60% 50% at 80% 90%, rgba(6,182,212,0.2) 0%, transparent 60%);
      animation: bgPulse 9s ease-in-out infinite alternate;
      z-index: 0;
    }
    @keyframes bgPulse {
      0%   { opacity: 0.7; transform: scale(1); }
      100% { opacity: 1;   transform: scale(1.05); }
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: 0;
    }

    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      pointer-events: none;
      z-index: 0;
    }
    .orb-1 { width: 400px; height: 400px; background: rgba(99,102,241,0.15); top: -100px; right: -100px; animation: float1 12s ease-in-out infinite; }
    .orb-2 { width: 300px; height: 300px; background: rgba(6,182,212,0.12); bottom: -80px; left: -80px; animation: float2 10s ease-in-out infinite; }
    @keyframes float1 { 0%,100% { transform: translate(0,0); } 50% { transform: translate(-40px,30px); } }
    @keyframes float2 { 0%,100% { transform: translate(0,0); } 50% { transform: translate(30px,-40px); } }

    .container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 460px;
      padding: 24px;
      animation: slideUp 0.6s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .brand {
      text-align: center;
      margin-bottom: 28px;
    }
    .brand-icon {
      width: 64px; height: 64px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 14px;
      box-shadow: 0 0 40px rgba(99,102,241,0.5);
      font-size: 28px;
      animation: iconPulse 3s ease-in-out infinite;
    }
    @keyframes iconPulse {
      0%,100% { box-shadow: 0 0 40px rgba(99,102,241,0.5); }
      50%      { box-shadow: 0 0 60px rgba(99,102,241,0.7), 0 0 80px rgba(6,182,212,0.3); }
    }
    .brand h1 { font-size: 26px; font-weight: 800; color: var(--text); letter-spacing: -0.5px; }
    .brand p  { font-size: 13px; color: var(--text-muted); margin-top: 4px; }

    .card {
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 36px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.08);
    }

    /* Step indicator */
    .steps {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      margin-bottom: 28px;
    }
    .step-dot {
      width: 32px; height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      background: rgba(255,255,255,0.06);
      border: 2px solid rgba(255,255,255,0.1);
      color: var(--text-muted);
      transition: all 0.3s ease;
    }
    .step-dot.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-color: var(--primary);
      color: #fff;
      box-shadow: 0 0 16px rgba(99,102,241,0.5);
    }
    .step-dot.done {
      background: rgba(16,185,129,0.2);
      border-color: rgba(16,185,129,0.5);
      color: #6ee7b7;
    }
    .step-line {
      flex: 1;
      max-width: 48px;
      height: 2px;
      background: rgba(255,255,255,0.08);
      transition: background 0.3s ease;
    }
    .step-line.done { background: rgba(99,102,241,0.5); }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }
    .card-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .field { margin-bottom: 16px; }
    .field label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .input-wrap { position: relative; }
    .input-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
      color: var(--text-muted);
      pointer-events: none;
      transition: color 0.2s;
    }
    .field input {
      width: 100%;
      padding: 13px 14px 13px 42px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      outline: none;
      transition: all 0.25s ease;
    }
    .field input::placeholder { color: rgba(148,163,184,0.5); }
    .field input:focus {
      border-color: var(--primary);
      background: rgba(99,102,241,0.08);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
    }
    .input-wrap:focus-within .input-icon { color: var(--primary-light); }

    .toggle-pw {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 16px;
      color: var(--text-muted);
      user-select: none;
      transition: color 0.2s;
    }
    .toggle-pw:hover { color: var(--text); }

    /* Password strength */
    .strength-bar { margin-top: 8px; display: flex; gap: 4px; }
    .strength-seg {
      flex: 1;
      height: 3px;
      border-radius: 99px;
      background: rgba(255,255,255,0.08);
      transition: background 0.3s ease;
    }
    .strength-seg.weak   { background: #ef4444; }
    .strength-seg.medium { background: #f59e0b; }
    .strength-seg.strong { background: #10b981; }
    .strength-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      text-align: right;
    }

    .btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      margin-top: 8px;
      position: relative;
      overflow: hidden;
      transition: all 0.25s ease;
      box-shadow: 0 4px 20px rgba(99,102,241,0.4);
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s ease;
    }
    .btn:hover::before { left: 100%; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(99,102,241,0.55); }
    .btn:active { transform: translateY(0); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-text { display: flex; align-items: center; justify-content: center; gap: 8px; }
    .spinner {
      display: none;
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .toast {
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      display: none;
      align-items: center;
      gap: 8px;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity:0; transform: translateY(-5px); } to { opacity:1; transform: translateY(0); } }
    .toast.error   { background: rgba(239,68,68,0.15);  border: 1px solid rgba(239,68,68,0.3);  color: #fca5a5; display: flex; }
    .toast.success { background: rgba(16,185,129,0.15); border: 1px solid rgba(16,185,129,0.3); color: #6ee7b7; display: flex; }

    .footer-link {
      text-align: center;
      margin-top: 24px;
      font-size: 13px;
      color: var(--text-muted);
    }
    .footer-link a {
      color: var(--primary-light);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .footer-link a:hover { color: var(--accent); text-decoration: underline; }

    .security-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 20px;
      font-size: 12px;
      color: rgba(148,163,184,0.6);
    }

    @media (max-width: 480px) {
      .card { padding: 24px; }
      .container { padding: 16px; }
    }
  </style>
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="container">
    <div class="brand">
      <div class="brand-icon">üó≥Ô∏è</div>
      <h1>VoteSecure</h1>
      <p>Create your voter account</p>
    </div>

    <div class="card">
      <!-- Step indicator -->
      <div class="steps">
        <div class="step-dot active" id="step1">1</div>
        <div class="step-line" id="line1"></div>
        <div class="step-dot" id="step2">2</div>
        <div class="step-line" id="line2"></div>
        <div class="step-dot" id="step3">‚úì</div>
      </div>

      <div class="card-title">Create Account</div>
      <div class="card-sub">Register to participate in the election</div>

      <div class="field">
        <label for="name">Full Name</label>
        <div class="input-wrap">
          <input type="text" id="name" placeholder="John Doe" autocomplete="name" oninput="onNameInput()" />
          <span class="input-icon">üë§</span>
        </div>
      </div>

      <div class="field">
        <label for="email">Email Address</label>
        <div class="input-wrap">
          <input type="email" id="email" placeholder="you@example.com" autocomplete="email" oninput="onEmailInput()" />
          <span class="input-icon">‚úâÔ∏è</span>
        </div>
      </div>

      <div class="field">
        <label for="password">Password</label>
        <div class="input-wrap">
          <input type="password" id="password" placeholder="Create a strong password" autocomplete="new-password" oninput="checkStrength()" />
          <span class="input-icon">üîí</span>
          <span class="toggle-pw" id="togglePw">üëÅÔ∏è</span>
        </div>
        <div class="strength-bar">
          <div class="strength-seg" id="s1"></div>
          <div class="strength-seg" id="s2"></div>
          <div class="strength-seg" id="s3"></div>
          <div class="strength-seg" id="s4"></div>
        </div>
        <div class="strength-label" id="strengthLabel">Password strength</div>
      </div>

      <button class="btn" id="regBtn" onclick="register()">
        <span class="btn-text">
          <div class="spinner" id="spinner"></div>
          <span id="btnLabel">Create Account</span>
        </span>
      </button>

      <div class="toast" id="toast"></div>
    </div>

    <div class="footer-link">
      Already registered? <a href="index.html">‚Üê Sign in here</a>
    </div>

    <div class="security-badge">
      üîê Secure Registration &nbsp;¬∑&nbsp; ‚úÖ Free & Transparent
    </div>
  </div>

  <script>
    let nameOk = false, emailOk = false;

    // Steps animation
    function onNameInput() {
      nameOk = document.getElementById('name').value.trim().length >= 2;
      updateSteps();
    }
    function onEmailInput() {
      emailOk = /\S+@\S+\.\S+/.test(document.getElementById('email').value);
      updateSteps();
    }
    function updateSteps() {
      const s1 = document.getElementById('step1');
      const s2 = document.getElementById('step2');
      const l1 = document.getElementById('line1');
      if (nameOk && emailOk) {
        s1.className = 'step-dot done'; s1.textContent = '‚úì';
        s2.className = 'step-dot active';
        l1.className = 'step-line done';
      } else if (nameOk) {
        s1.className = 'step-dot done'; s1.textContent = '‚úì';
        s2.className = 'step-dot';
        l1.className = 'step-line done';
      } else {
        s1.className = 'step-dot active'; s1.textContent = '1';
        s2.className = 'step-dot';
        l1.className = 'step-line';
      }
    }

    // Password toggle
    const toggler = document.getElementById('togglePw');
    toggler.addEventListener('click', () => {
      const pw = document.getElementById('password');
      const isText = pw.type === 'text';
      pw.type = isText ? 'password' : 'text';
      toggler.textContent = isText ? 'üëÅÔ∏è' : 'üôà';
    });

    // Password strength
    function checkStrength() {
      const pw = document.getElementById('password').value;
      let score = 0;
      if (pw.length >= 6)  score++;
      if (pw.length >= 10) score++;
      if (/[A-Z]/.test(pw) && /[0-9]/.test(pw)) score++;
      if (/[^A-Za-z0-9]/.test(pw)) score++;

      const segs = ['s1','s2','s3','s4'];
      const labels = ['','Weak','Fair','Good','Strong'];
      const classes = ['','weak','weak','medium','strong'];
      segs.forEach((id,i) => {
        const el = document.getElementById(id);
        el.className = 'strength-seg';
        if (i < score) el.classList.add(classes[score]);
      });
      document.getElementById('strengthLabel').textContent = score > 0 ? labels[score] : 'Password strength';

      if (score >= 2) {
        const s2 = document.getElementById('step2');
        const s3 = document.getElementById('step3');
        const l2 = document.getElementById('line2');
        if (nameOk && emailOk) {
          s2.className = 'step-dot done'; s2.textContent = '‚úì';
          s3.className = 'step-dot active';
          l2.className = 'step-line done';
        }
      }
    }

    function showToast(msg, type) {
      const t = document.getElementById('toast');
      t.textContent = (type === 'error' ? '‚õî ' : '‚úÖ ') + msg;
      t.className = 'toast ' + type;
    }

    function setLoading(on) {
      const btn = document.getElementById('regBtn');
      const spinner = document.getElementById('spinner');
      const label = document.getElementById('btnLabel');
      btn.disabled = on;
      spinner.style.display = on ? 'block' : 'none';
      label.textContent = on ? 'Creating account...' : 'Create Account';
    }

    document.addEventListener('keydown', e => { if (e.key === 'Enter') register(); });

    function register() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!name || !email || !password) {
        showToast('Please fill in all fields.', 'error');
        return;
      }
      if (!/\S+@\S+\.\S+/.test(email)) {
        showToast('Please enter a valid email address.', 'error');
        return;
      }
      if (password.length < 6) {
        showToast('Password must be at least 6 characters.', 'error');
        return;
      }

      setLoading(true);

      fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password })
      })
        .then(async res => {
          const data = await res.json();
          setLoading(false);
          if (!res.ok) {
            showToast(data.message || 'Registration failed. Please try again.', 'error');
            return;
          }
          showToast(data.message || 'Registration successful!', 'success');
          // Mark all steps done
          ['step1','step2','step3'].forEach(id => {
            document.getElementById(id).className = 'step-dot done';
            document.getElementById(id).textContent = '‚úì';
          });
          ['line1','line2'].forEach(id => document.getElementById(id).className = 'step-line done');
          setTimeout(() => { window.location = 'index.html'; }, 1500);
        })
        .catch(() => {
          setLoading(false);
          showToast('Registration failed. Please try again.', 'error');
        });
    }
  </script>
</body>
</html>