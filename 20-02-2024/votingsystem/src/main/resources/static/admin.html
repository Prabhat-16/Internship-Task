<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <title>VoteSecure ‚Äî Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #060714;
      --surface:   #0e1020;
      --surface2:  #161828;
      --border:    rgba(255,255,255,0.07);
      --text:      #f1f5f9;
      --muted:     #64748b;
      --primary:   #6366f1;
      --primary2:  #818cf8;
      --accent:    #06b6d4;
      --success:   #10b981;
      --warning:   #f59e0b;
      --danger:    #ef4444;
      --gold:      #f59e0b;
    }

    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

    /* ‚îÄ‚îÄ Background ‚îÄ‚îÄ */
    #particles-canvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
    .orb { position: fixed; border-radius: 50%; filter: blur(120px); pointer-events: none; z-index: 0; }
    .orb-1 { width: 600px; height: 600px; background: radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%); top: -200px; left: -200px; animation: orbF1 14s ease-in-out infinite; }
    .orb-2 { width: 500px; height: 500px; background: radial-gradient(circle, rgba(6,182,212,0.08) 0%, transparent 70%); bottom: -150px; right: -150px; animation: orbF2 11s ease-in-out infinite; }
    @keyframes orbF1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(50px,40px)} }
    @keyframes orbF2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-40px,-50px)} }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .layout { display: flex; min-height: 100vh; position: relative; z-index: 1; }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .sidebar {
      width: 256px;
      background: rgba(14,16,32,0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column; padding: 24px 16px;
      position: fixed; top: 0; left: 0; height: 100vh;
      animation: slideInLeft 0.5s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    .sidebar::after {
      content: ''; position: absolute; top: 0; right: 0; bottom: 0; width: 1px;
      background: linear-gradient(180deg, transparent, rgba(99,102,241,0.4), rgba(6,182,212,0.2), transparent);
    }
    .sidebar-brand {
      display: flex; align-items: center; gap: 12px; padding: 4px 8px 28px;
      border-bottom: 1px solid var(--border); margin-bottom: 16px;
    }
    .sidebar-brand .icon {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;
      box-shadow: 0 0 20px rgba(99,102,241,0.4); animation: iconGlow 3s ease-in-out infinite;
    }
    @keyframes iconGlow {
      0%,100% { box-shadow: 0 0 20px rgba(99,102,241,0.4); }
      50%      { box-shadow: 0 0 35px rgba(99,102,241,0.6), 0 0 60px rgba(6,182,212,0.2); }
    }
    .sidebar-brand-text span { display: block; font-size: 16px; font-weight: 800; letter-spacing: -0.3px; }
    .sidebar-brand small {
      display: inline-block; color: var(--danger); font-size: 10px; font-weight: 700;
      background: rgba(239,68,68,0.12); padding: 2px 7px; border-radius: 5px;
      border: 1px solid rgba(239,68,68,0.25); letter-spacing: 0.5px;
    }

    .nav-label {
      font-size: 10px; font-weight: 700; color: var(--muted);
      text-transform: uppercase; letter-spacing: 1px;
      padding: 0 8px 8px; margin-top: 10px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px; padding: 11px 12px;
      border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 500;
      color: var(--muted); transition: all 0.25s ease; margin-bottom: 2px;
      border: none; background: transparent; width: 100%; text-align: left;
      position: relative; overflow: hidden;
    }
    .nav-item::before {
      content: ''; position: absolute; inset: 0; border-radius: 12px;
      background: linear-gradient(135deg, rgba(99,102,241,0.12), rgba(6,182,212,0.06));
      opacity: 0; transition: opacity 0.25s;
    }
    .nav-item:hover { color: var(--text); }
    .nav-item:hover::before { opacity: 1; }
    .nav-item.active {
      background: rgba(99,102,241,0.15); color: var(--primary2);
      border: 1px solid rgba(99,102,241,0.2);
      box-shadow: 0 0 20px rgba(99,102,241,0.1);
    }
    .nav-item .ni { font-size: 18px; width: 22px; text-align: center; }
    .nav-active-bar {
      position: absolute; right: 0; top: 20%; bottom: 20%; width: 3px;
      background: linear-gradient(180deg, var(--primary), var(--accent));
      border-radius: 4px 0 0 4px; opacity: 0; transition: opacity 0.25s;
    }
    .nav-item.active .nav-active-bar { opacity: 1; }

    .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border); }
    .logout-btn {
      width: 100%; padding: 11px 14px; border-radius: 12px;
      border: 1px solid rgba(239,68,68,0.25);
      background: rgba(239,68,68,0.07); color: var(--danger);
      font-size: 14px; font-weight: 600; cursor: pointer;
      display: flex; align-items: center; gap: 8px; transition: all 0.25s;
    }
    .logout-btn:hover { background: rgba(239,68,68,0.18); transform: translateY(-1px); border-color: rgba(239,68,68,0.4); }

    /* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
    .main { margin-left: 256px; flex: 1; padding: 0; }

    /* ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ */
    .topbar {
      background: rgba(14,16,32,0.9); backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 36px; height: 66px;
      display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; z-index: 100;
      animation: slideDown 0.5s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .topbar::after {
      content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(99,102,241,0.4), transparent);
    }
    .topbar h2 { font-size: 20px; font-weight: 800; letter-spacing: -0.3px; }
    .topbar-right { display: flex; align-items: center; gap: 16px; }
    .admin-badge {
      display: flex; align-items: center; gap: 10px; padding: 7px 16px;
      background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.25);
      border-radius: 100px; transition: all 0.2s;
    }
    .admin-badge:hover { background: rgba(99,102,241,0.15); }
    .admin-avatar {
      width: 30px; height: 30px; border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 800;
    }
    .admin-name { font-size: 14px; font-weight: 600; }

    /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
    .content { padding: 36px; }
    .tab-panel { display: none; animation: fadeIn 0.35s ease; }
    .tab-panel.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* ‚îÄ‚îÄ Stats Cards ‚îÄ‚îÄ */
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px; margin-bottom: 32px;
    }
    .stat-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 20px; padding: 26px; position: relative; overflow: hidden;
      transition: all 0.35s cubic-bezier(0.16,1,0.3,1);
      animation: cardIn 0.6s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes cardIn { from { opacity: 0; transform: translateY(20px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }
    .stat-card::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      border-radius: 20px 20px 0 0;
    }
    .stat-card::before {
      content: ''; position: absolute; inset: 0; opacity: 0;
      transition: opacity 0.35s;
    }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 50px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.15); }
    .stat-card:hover::before { opacity: 1; }
    .stat-card.purple::after { background: linear-gradient(90deg, var(--primary), var(--primary2)); }
    .stat-card.purple::before { background: radial-gradient(ellipse at top, rgba(99,102,241,0.08), transparent); }
    .stat-card.cyan::after   { background: linear-gradient(90deg, var(--accent), #3b82f6); }
    .stat-card.cyan::before  { background: radial-gradient(ellipse at top, rgba(6,182,212,0.08), transparent); }
    .stat-card.green::after  { background: linear-gradient(90deg, var(--success), var(--accent)); }
    .stat-card.green::before { background: radial-gradient(ellipse at top, rgba(16,185,129,0.08), transparent); }
    .stat-card.gold::after   { background: linear-gradient(90deg, var(--gold), #f97316); }
    .stat-card.gold::before  { background: radial-gradient(ellipse at top, rgba(245,158,11,0.08), transparent); }
    .stat-card.rose::after   { background: linear-gradient(90deg, #ec4899, var(--primary)); }
    .stat-card.rose::before  { background: radial-gradient(ellipse at top, rgba(236,72,153,0.08), transparent); }

    .stat-icon { font-size: 30px; margin-bottom: 14px; }
    .stat-value { font-size: 34px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.5px; }
    .stat-label { font-size: 13px; color: var(--muted); font-weight: 600; letter-spacing: 0.2px; }
    .stat-sub { font-size: 12px; color: var(--muted); margin-top: 8px; font-style: italic; }

    /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
    .card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 20px; overflow: hidden; margin-bottom: 24px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .card:hover { border-color: rgba(99,102,241,0.2); box-shadow: 0 0 40px rgba(99,102,241,0.05); }
    .card-header {
      padding: 22px 28px 0;
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
    }
    .card-title { font-size: 16px; font-weight: 800; letter-spacing: -0.2px; }
    .card-body { padding: 0 28px 28px; }

    /* ‚îÄ‚îÄ Chart ‚îÄ‚îÄ */
    .chart-wrap { height: 300px; position: relative; }
    canvas { width: 100% !important; }

    /* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
    .results-list { display: flex; flex-direction: column; gap: 14px; }
    .result-row {
      display: flex; align-items: center; gap: 16px;
      background: var(--surface2); border-radius: 14px; padding: 18px;
      transition: all 0.25s ease; border: 1px solid transparent;
      animation: cardIn 0.5s cubic-bezier(0.16,1,0.3,1) both;
    }
    .result-row:hover { background: rgba(255,255,255,0.04); border-color: rgba(99,102,241,0.15); transform: translateX(4px); }
    .result-rank {
      width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center;
      justify-content: center; font-weight: 800; font-size: 14px; flex-shrink: 0;
    }
    .result-rank.r1 { background: linear-gradient(135deg,#f59e0b,#f97316); color:#000; box-shadow: 0 0 20px rgba(245,158,11,0.4); }
    .result-rank.r2 { background: linear-gradient(135deg,#64748b,#475569); color:#fff; }
    .result-rank.r3 { background: linear-gradient(135deg,#92400e,#78350f); color:#fff; }
    .result-rank.rn { background: var(--surface); border:1px solid var(--border); color:var(--muted); }
    .result-info { flex: 1; }
    .result-name { font-size: 15px; font-weight: 700; margin-bottom: 3px; }
    .result-party { font-size: 12px; color: var(--muted); font-weight: 500; }
    .result-bar-wrap { flex: 2; }
    .result-meta { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
    .bar-track { height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow:hidden; }
    .bar-fill { height: 100%; border-radius: 4px; transition: width 1.2s cubic-bezier(.16,1,.3,1); width: 0; position: relative; overflow: hidden; }
    .bar-fill::after {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
      animation: barShimmer 2s ease-in-out infinite;
    }
    @keyframes barShimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(200%)} }
    .result-votes { font-size: 18px; font-weight: 800; min-width: 60px; text-align:right; }

    /* ‚îÄ‚îÄ Users Table ‚îÄ‚îÄ */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    thead th {
      padding: 13px 18px; text-align: left; font-size: 11px; font-weight: 700;
      color: var(--muted); text-transform: uppercase; letter-spacing: 0.8px;
      border-bottom: 1px solid var(--border); background: var(--surface2);
    }
    tbody tr { border-bottom: 1px solid rgba(255,255,255,0.04); transition: background 0.2s; }
    tbody tr:hover { background: rgba(99,102,241,0.04); }
    tbody td { padding: 15px 18px; vertical-align: middle; }
    tbody tr:last-child { border-bottom: none; }
    .user-cell { display: flex; align-items: center; gap: 12px; }
    .u-avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 800; flex-shrink: 0;
    }
    .u-name { font-weight: 700; font-size: 14px; }
    .u-email { font-size: 12px; color: var(--muted); }
    .badge {
      display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px;
      border-radius: 20px; font-size: 11px; font-weight: 700; letter-spacing: 0.3px;
    }
    .badge-admin   { background: rgba(99,102,241,0.15);  color:var(--primary2);  border: 1px solid rgba(99,102,241,0.3); }
    .badge-user    { background: rgba(6,182,212,0.1);    color:var(--accent);    border: 1px solid rgba(6,182,212,0.2); }
    .badge-voted   { background: rgba(16,185,129,0.12);  color:var(--success);   border: 1px solid rgba(16,185,129,0.3); }
    .badge-pending { background: rgba(100,116,139,0.1);  color:var(--muted);     border: 1px solid rgba(100,116,139,0.2); }

    /* ‚îÄ‚îÄ Candidates Management ‚îÄ‚îÄ */
    .add-form {
      background: var(--surface2); border-radius: 16px; padding: 22px;
      display: flex; gap: 14px; align-items: flex-end; flex-wrap: wrap;
      margin-bottom: 22px; border: 1px solid var(--border);
      transition: border-color 0.3s;
    }
    .add-form:focus-within { border-color: rgba(99,102,241,0.35); }
    .form-group { display: flex; flex-direction: column; gap: 7px; flex: 1; min-width: 160px; }
    .form-group label { font-size: 11px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.8px; }
    .form-input {
      background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
      color: var(--text); padding: 11px 14px; font-size: 14px; font-family: inherit;
      outline: none; transition: all 0.25s;
    }
    .form-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99,102,241,0.12); }

    .btn {
      padding: 11px 22px; border-radius: 12px; border: none; cursor: pointer;
      font-size: 14px; font-weight: 700; font-family: inherit; transition: all 0.25s;
      display: inline-flex; align-items: center; gap: 6px; position: relative; overflow: hidden;
    }
    .btn::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
      transition: left 0.5s;
    }
    .btn:hover::before { left: 100%; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary2)); color: #fff; box-shadow: 0 4px 16px rgba(99,102,241,0.4); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(99,102,241,0.55); }
    .btn-danger  { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid rgba(239,68,68,0.25); }
    .btn-danger:hover  { background: rgba(239,68,68,0.22); transform: translateY(-1px); }
    .btn-warning { background: rgba(245,158,11,0.1); color: var(--gold); border: 1px solid rgba(245,158,11,0.25); }
    .btn-warning:hover { background: rgba(245,158,11,0.22); }
    .btn-sm { padding: 7px 15px; font-size: 12px; border-radius: 9px; }

    .cand-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px; background: var(--surface2); border-radius: 14px;
      margin-bottom: 10px; transition: all 0.25s; gap: 14px;
      border: 1px solid transparent;
    }
    .cand-row:hover { background: rgba(255,255,255,0.04); border-color: rgba(99,102,241,0.15); transform: translateX(4px); }
    .cand-info { flex: 1; }
    .cand-name { font-weight: 700; margin-bottom: 3px; }
    .cand-party { font-size: 12px; color: var(--muted); }
    .cand-votes { font-size: 22px; font-weight: 900; color: var(--primary2); min-width: 70px; text-align: center; }

    /* Ripple */
    .ripple {
      position: absolute; border-radius: 50%; background: rgba(255,255,255,0.2);
      transform: scale(0); animation: rippleAnim 0.6s ease-out; pointer-events: none;
    }
    @keyframes rippleAnim { to { transform: scale(4); opacity: 0; } }

    /* ‚îÄ‚îÄ Danger Zone ‚îÄ‚îÄ */
    .danger-zone {
      border: 1px solid rgba(239,68,68,0.2); border-radius: 20px; padding: 28px;
      background: rgba(239,68,68,0.04); transition: border-color 0.3s;
    }
    .danger-zone:hover { border-color: rgba(239,68,68,0.35); }
    .danger-zone h3 { color: var(--danger); margin-bottom: 10px; font-size: 18px; font-weight: 800; }
    .danger-zone p  { color: var(--muted); font-size: 14px; margin-bottom: 20px; line-height: 1.6; }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    .toast {
      position: fixed; bottom: 32px; right: 32px; z-index: 9999;
      padding: 15px 22px; border-radius: 14px; font-size: 14px; font-weight: 600;
      max-width: 380px; box-shadow: 0 12px 40px rgba(0,0,0,0.5);
      transition: all 0.4s cubic-bezier(0.16,1,0.3,1); opacity: 0; transform: translateY(20px) scale(0.95);
    }
    .toast.show { opacity: 1; transform: translateY(0) scale(1); }
    .toast.success { background: rgba(16,185,129,0.15);  border: 1px solid rgba(16,185,129,0.35); color: var(--success); }
    .toast.error   { background: rgba(239,68,68,0.15);   border: 1px solid rgba(239,68,68,0.35);  color: var(--danger); }
    .toast.info    { background: rgba(99,102,241,0.15);  border: 1px solid rgba(99,102,241,0.35); color: var(--primary2); }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.75);
      backdrop-filter: blur(12px); z-index: 1000;
      display: none; align-items: center; justify-content: center;
    }
    .modal-overlay.open { display: flex; animation: fadeInBg 0.2s ease; }
    @keyframes fadeInBg { from { opacity: 0; } to { opacity: 1; } }
    .modal-box {
      background: rgba(15,16,48,0.98);
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 28px; padding: 40px; max-width: 440px; width: 90%;
      text-align: center;
      animation: popIn 0.4s cubic-bezier(0.16,1,0.3,1) both;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.04) inset, 0 30px 80px rgba(0,0,0,0.6), 0 0 60px rgba(99,102,241,0.1);
    }
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.88) translateY(30px); }
      to   { opacity: 1; transform: scale(1) translateY(0); }
    }
    .modal-icon { font-size: 52px; margin-bottom: 18px; animation: iconBounce 0.5s cubic-bezier(0.16,1,0.3,1) 0.1s both; }
    @keyframes iconBounce { from { transform: scale(0); } to { transform: scale(1); } }
    .modal-title { font-size: 22px; font-weight: 800; margin-bottom: 10px; letter-spacing: -0.3px; }
    .modal-msg { color: var(--muted); font-size: 14px; margin-bottom: 28px; line-height: 1.7; }
    .modal-actions { display: flex; gap: 12px; justify-content: center; }

    /* ‚îÄ‚îÄ Empty ‚îÄ‚îÄ */
    .empty { text-align: center; padding: 48px; color: var(--muted); }
    .empty-icon { font-size: 44px; margin-bottom: 14px; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media(max-width:768px) {
      .sidebar { display: none; } .main { margin-left: 0; } .content { padding: 20px; }
    }
  </style>
</head>
<body>
  <canvas id="particles-canvas"></canvas>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="layout">
    <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <div class="icon">üó≥Ô∏è</div>
        <div class="sidebar-brand-text">
          <span>VoteSecure</span>
          <small>ADMIN</small>
        </div>
      </div>

      <div class="nav-label">Overview</div>
      <button class="nav-item active" id="nav-dashboard" onclick="showTab('dashboard')">
        <span class="ni">üìä</span> Dashboard
        <span class="nav-active-bar"></span>
      </button>
      <button class="nav-item" id="nav-results" onclick="showTab('results')">
        <span class="ni">üèÜ</span> Vote Results
        <span class="nav-active-bar"></span>
      </button>

      <div class="nav-label" style="margin-top:16px">Management</div>
      <button class="nav-item" id="nav-candidates" onclick="showTab('candidates')">
        <span class="ni">üë§</span> Candidates
        <span class="nav-active-bar"></span>
      </button>
      <button class="nav-item" id="nav-users" onclick="showTab('users')">
        <span class="ni">üë•</span> Users
        <span class="nav-active-bar"></span>
      </button>

      <div class="nav-label" style="margin-top:16px">System</div>
      <button class="nav-item" id="nav-settings" onclick="showTab('settings')">
        <span class="ni">‚öôÔ∏è</span> Settings
        <span class="nav-active-bar"></span>
      </button>

      <div class="sidebar-footer">
        <button class="logout-btn" onclick="logout()">üö™ Logout</button>
      </div>
    </aside>

    <!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ -->
    <div class="main">
      <!-- Topbar -->
      <div class="topbar">
        <h2 id="pageTitle">Dashboard</h2>
        <div class="topbar-right">
          <div class="admin-badge">
            <div class="admin-avatar" id="adminAvatar">A</div>
            <span class="admin-name" id="adminName">Admin</span>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="content">

        <!-- ‚îÄ‚îÄ‚îÄ Dashboard Tab ‚îÄ‚îÄ‚îÄ -->
        <div class="tab-panel active" id="tab-dashboard">
          <div class="stats-grid">
            <div class="stat-card purple" style="animation-delay:0s">
              <div class="stat-icon">üë•</div>
              <div class="stat-value" id="s-users">‚Äî</div>
              <div class="stat-label">Registered Voters</div>
            </div>
            <div class="stat-card cyan" style="animation-delay:0.08s">
              <div class="stat-icon">üó≥Ô∏è</div>
              <div class="stat-value" id="s-votes">‚Äî</div>
              <div class="stat-label">Total Votes Cast</div>
            </div>
            <div class="stat-card green" style="animation-delay:0.16s">
              <div class="stat-icon">üìà</div>
              <div class="stat-value" id="s-turnout">‚Äî</div>
              <div class="stat-label">Voter Turnout</div>
            </div>
            <div class="stat-card gold" style="animation-delay:0.24s">
              <div class="stat-icon">üèÜ</div>
              <div class="stat-value" id="s-leader" style="font-size:18px">‚Äî</div>
              <div class="stat-label">Current Leader</div>
              <div class="stat-sub" id="s-leader-party">‚Äî</div>
            </div>
            <div class="stat-card rose" style="animation-delay:0.32s">
              <div class="stat-icon">üéØ</div>
              <div class="stat-value" id="s-candidates">‚Äî</div>
              <div class="stat-label">Candidates</div>
            </div>
          </div>

          <!-- Bar Chart -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">üìä Live Vote Distribution</div>
              <button class="btn btn-primary btn-sm" onclick="loadAll(this)">‚Ü∫ Refresh</button>
            </div>
            <div class="card-body">
              <div class="chart-wrap">
                <canvas id="voteChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ Results Tab ‚îÄ‚îÄ‚îÄ -->
        <div class="tab-panel" id="tab-results">
          <div class="card">
            <div class="card-header">
              <div class="card-title">üèÜ Election Results ‚Äî Rankings</div>
              <button class="btn btn-primary btn-sm" onclick="loadAll()">‚Ü∫ Refresh</button>
            </div>
            <div class="card-body">
              <div class="results-list" id="resultsList">
                <div class="empty"><div class="empty-icon">‚è≥</div>Loading results‚Ä¶</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ Candidates Tab ‚îÄ‚îÄ‚îÄ -->
        <div class="tab-panel" id="tab-candidates">
          <div class="card">
            <div class="card-header">
              <div class="card-title">üë§ Manage Candidates</div>
            </div>
            <div class="card-body">
              <div class="add-form">
                <div class="form-group">
                  <label>Candidate Name</label>
                  <input class="form-input" id="newCandName" placeholder="e.g. Ravi Kumar" type="text"/>
                </div>
                <div class="form-group">
                  <label>Party</label>
                  <input class="form-input" id="newCandParty" placeholder="e.g. Unity Party" type="text"/>
                </div>
                <button class="btn btn-primary" onclick="addCandidate(this, event)">‚ûï Add Candidate</button>
              </div>
              <div id="candidatesList">
                <div class="empty"><div class="empty-icon">‚è≥</div>Loading‚Ä¶</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ Users Tab ‚îÄ‚îÄ‚îÄ -->
        <div class="tab-panel" id="tab-users">
          <div class="card">
            <div class="card-header">
              <div class="card-title">üë• Registered Users</div>
              <button class="btn btn-primary btn-sm" onclick="loadAll()">‚Ü∫ Refresh</button>
            </div>
            <div class="card-body">
              <input class="form-input" id="userSearch" type="text" placeholder="üîç  Search by name or email‚Ä¶"
                style="width:100%; margin-bottom:18px;" oninput="filterUsers()"/>
              <div class="table-wrap">
                <table>
                  <thead><tr><th>#</th><th>User</th><th>Role</th><th>Vote Status</th></tr></thead>
                  <tbody id="usersTable">
                    <tr><td colspan="4" class="empty">Loading‚Ä¶</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ Settings Tab ‚îÄ‚îÄ‚îÄ -->
        <div class="tab-panel" id="tab-settings">
          <div class="danger-zone">
            <h3>‚ö†Ô∏è Danger Zone</h3>
            <p>These actions are irreversible. Proceed with extreme caution. All vote data will be permanently cleared.</p>
            <button class="btn btn-danger" onclick="confirmReset()">
              üîÑ Reset All Votes
            </button>
          </div>
        </div>

      </div><!-- /content -->
    </div><!-- /main -->
  </div><!-- /layout -->

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Modal -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-box">
      <div class="modal-icon">‚ö†Ô∏è</div>
      <div class="modal-title" id="modalTitle">Are you sure?</div>
      <div class="modal-msg" id="modalMsg">This action cannot be undone.</div>
      <div class="modal-actions">
        <button class="btn btn-warning" onclick="closeModal()">Cancel</button>
        <button class="btn btn-danger" id="modalConfirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
    // ‚îÄ‚îÄ Auth Guard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const role = localStorage.getItem('userRole');
    if (role !== 'ADMIN') { window.location = 'index.html'; }

    const adminName = localStorage.getItem('userName') || 'Admin';
    const initials  = adminName.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
    document.getElementById('adminName').textContent  = adminName;
    document.getElementById('adminAvatar').textContent = initials;

    /* ‚îÄ‚îÄ Particle Canvas ‚îÄ‚îÄ */
    (function() {
      const canvas = document.getElementById('particles-canvas');
      const ctx = canvas.getContext('2d');
      let W, H, particles = [];
      function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
      resize(); window.addEventListener('resize', resize);
      function mkP() {
        return { x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.2+0.3,
          dx: (Math.random()-0.5)*0.2, dy: (Math.random()-0.5)*0.2, alpha: Math.random()*0.35+0.08,
          color: ['rgba(99,102,241,','rgba(6,182,212,','rgba(168,85,247,'][Math.floor(Math.random()*3)] };
      }
      for (let i = 0; i < 60; i++) particles.push(mkP());
      function draw() {
        ctx.clearRect(0,0,W,H);
        particles.forEach(p => {
          ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle = p.color+p.alpha+')'; ctx.fill();
          p.x+=p.dx; p.y+=p.dy;
          if(p.x<0||p.x>W) p.dx*=-1; if(p.y<0||p.y>H) p.dy*=-1;
        });
        requestAnimationFrame(draw);
      }
      draw();
    })();

    /* ‚îÄ‚îÄ Ripple ‚îÄ‚îÄ */
    function addRipple(btn, e) {
      const rect = btn.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const r = document.createElement('span'); r.className = 'ripple';
      r.style.cssText = `width:${size}px;height:${size}px;left:${e.clientX-rect.left-size/2}px;top:${e.clientY-rect.top-size/2}px`;
      btn.appendChild(r); setTimeout(() => r.remove(), 600);
    }

    /* ‚îÄ‚îÄ Animated counter ‚îÄ‚îÄ */
    function animateCount(el, target) {
      const dur = 1200; const start = performance.now();
      function update(now) {
        const p = Math.min((now-start)/dur, 1);
        const e = 1 - Math.pow(1-p, 3);
        const val = Math.round(target * e);
        el.textContent = typeof target === 'number' && target < 1000 ? val : val.toLocaleString();
        if (p < 1) requestAnimationFrame(update);
      }
      requestAnimationFrame(update);
    }

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let allCandidates = [], allUsers = [], chartInstance = null;
    const tabs  = ['dashboard','results','candidates','users','settings'];
    const titles = { dashboard:'Dashboard', results:'Vote Results', candidates:'Manage Candidates', users:'Users', settings:'Settings' };

    function showTab(name) {
      tabs.forEach(t => {
        document.getElementById('tab-'+t).classList.toggle('active', t===name);
        document.getElementById('nav-'+t)?.classList.toggle('active', t===name);
      });
      document.getElementById('pageTitle').textContent = titles[name] || name;
      if (name === 'dashboard' && chartInstance) setTimeout(() => chartInstance.update(), 50);
    }

    async function loadAll() {
      await Promise.all([loadStats(), loadCandidates(), loadUsers()]);
    }

    async function loadStats() {
      try {
        const res = await fetch('/api/admin/stats');
        const d   = await res.json();
        const mapNum = (id, val) => {
          const el = document.getElementById(id);
          const num = parseFloat(val);
          if (!isNaN(num) && el) animateCount(el, num);
          else if (el) el.textContent = val;
        };
        mapNum('s-users', d.totalUsers);
        mapNum('s-votes', d.totalVotes);
        document.getElementById('s-turnout').textContent    = d.voterTurnout + '%';
        document.getElementById('s-leader').textContent     = d.leadingCandidate;
        document.getElementById('s-leader-party').textContent = d.leadingParty;
        mapNum('s-candidates', d.totalCandidates);
      } catch(e) { showToast('Failed to load stats.', 'error'); }
    }

    async function loadCandidates() {
      try {
        const res = await fetch('/api/candidates');
        allCandidates = await res.json();
        renderChart(allCandidates);
        renderResults(allCandidates);
        renderCandidatesList(allCandidates);
      } catch(e) { showToast('Failed to load candidates.', 'error'); }
    }

    const COLORS = ['#6366f1','#06b6d4','#10b981','#f59e0b','#ec4899','#8b5cf6','#3b82f6','#14b8a6','#f97316','#a855f7'];

    function renderChart(data) {
      const ctx = document.getElementById('voteChart').getContext('2d');
      if (chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(c => c.name),
          datasets: [{
            label: 'Votes', data: data.map(c => c.voteCount || 0),
            backgroundColor: data.map((_,i) => COLORS[i%COLORS.length]+'bb'),
            borderColor: data.map((_,i) => COLORS[i%COLORS.length]),
            borderWidth: 2, borderRadius: 10, borderSkipped: false,
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          animation: { duration: 1200, easing: 'easeOutQuart' },
          plugins: {
            legend: { display: false },
            tooltip: { callbacks: { label: ctx => ` ${ctx.raw} votes` },
              backgroundColor: 'rgba(15,16,48,0.95)', borderColor: 'rgba(99,102,241,0.3)',
              borderWidth: 1, padding: 12, titleFont: { weight: '700' } }
          },
          scales: {
            x: { ticks: { color: '#94a3b8', font: {size:12,weight:'600'} }, grid: { display:false } },
            y: { ticks: { color: '#94a3b8', font: {size:12}, stepSize: 1 },
                 grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true }
          }
        }
      });
    }

    function renderResults(data) {
      const sorted = [...data].sort((a,b) => (b.voteCount||0)-(a.voteCount||0));
      const total  = sorted.reduce((s,c) => s+(c.voteCount||0), 0);
      const list   = document.getElementById('resultsList');
      if (sorted.length === 0) { list.innerHTML = '<div class="empty"><div class="empty-icon">üó≥Ô∏è</div>No candidates yet.</div>'; return; }
      list.innerHTML = sorted.map((c, i) => {
        const pct  = total > 0 ? Math.round(((c.voteCount||0)/total)*100) : 0;
        const rank = i===0?'r1':i===1?'r2':i===2?'r3':'rn';
        const color = COLORS[i%COLORS.length];
        return `
        <div class="result-row" style="animation-delay:${i*0.06}s">
          <div class="result-rank ${rank}">${i+1}</div>
          <div class="result-info">
            <div class="result-name">${c.name}</div>
            <div class="result-party">${c.party}</div>
          </div>
          <div class="result-bar-wrap">
            <div class="result-meta"><span style="color:${color};font-weight:700">${pct}%</span><span>${(c.voteCount||0)} votes</span></div>
            <div class="bar-track"><div class="bar-fill" id="rf-${c.id}" style="background:linear-gradient(90deg,${color},${color}99)"></div></div>
          </div>
          <div class="result-votes" style="color:${color}">${(c.voteCount||0).toLocaleString()}</div>
        </div>`;
      }).join('');
      requestAnimationFrame(() => {
        sorted.forEach(c => {
          const pct = total > 0 ? Math.round(((c.voteCount||0)/total)*100) : 0;
          const bar = document.getElementById('rf-'+c.id);
          if (bar) setTimeout(() => { bar.style.width = pct+'%'; }, 80);
        });
      });
    }

    function renderCandidatesList(data) {
      const sorted = [...data].sort((a,b) => (b.voteCount||0)-(a.voteCount||0));
      const el = document.getElementById('candidatesList');
      if (sorted.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-icon">üë§</div>No candidates yet. Add one above.</div>'; return; }
      el.innerHTML = sorted.map((c,i) => `
        <div class="cand-row" style="animation-delay:${i*0.05}s">
          <div class="cand-info">
            <div class="cand-name">${c.name}</div>
            <div class="cand-party">${c.party}</div>
          </div>
          <div class="cand-votes">${(c.voteCount||0)} <small style="font-size:11px;font-weight:400;color:var(--muted)">votes</small></div>
          <button class="btn btn-danger btn-sm" onclick="confirmDeleteCandidate(${c.id},'${c.name.replace(/'/g,"\\'")}')">
            üóëÔ∏è Delete
          </button>
        </div>`).join('');
    }

    async function addCandidate(btnEl, event) {
      if (btnEl && event) addRipple(btnEl, event);
      const name  = document.getElementById('newCandName').value.trim();
      const party = document.getElementById('newCandParty').value.trim();
      if (!name || !party) { showToast('Please enter both name and party.', 'error'); return; }
      try {
        const res = await fetch('/api/admin/candidates', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, party }) });
        const d = await res.json();
        if (!res.ok) { showToast(d.message || 'Failed to add candidate.', 'error'); return; }
        document.getElementById('newCandName').value = ''; document.getElementById('newCandParty').value = '';
        showToast('‚úÖ Candidate added!', 'success'); loadAll();
      } catch(e) { showToast('Network error.', 'error'); }
    }

    function confirmDeleteCandidate(id, name) {
      openModal('üóëÔ∏è Delete Candidate', `Are you sure you want to delete <strong>${name}</strong>? This cannot be undone.`, () => deleteCandidate(id));
    }

    async function deleteCandidate(id) {
      closeModal();
      try {
        const res = await fetch('/api/admin/candidates/'+id, { method: 'DELETE' });
        const d   = await res.json();
        if (!res.ok) { showToast(d.message || 'Failed to delete.', 'error'); return; }
        showToast('‚úÖ Candidate deleted.', 'success'); loadAll();
      } catch(e) { showToast('Network error.', 'error'); }
    }

    async function loadUsers() {
      try {
        const res = await fetch('/api/admin/users');
        allUsers = await res.json(); renderUsers(allUsers);
      } catch(e) { showToast('Failed to load users.', 'error'); }
    }

    function renderUsers(list) {
      const tbody = document.getElementById('usersTable');
      if (list.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="empty">No users found.</td></tr>'; return; }
      tbody.innerHTML = list.map((u, i) => {
        const av = (u.name||'?').split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase();
        return `
        <tr>
          <td style="color:var(--muted);font-size:13px;font-weight:600">${i+1}</td>
          <td>
            <div class="user-cell">
              <div class="u-avatar">${av}</div>
              <div><div class="u-name">${u.name}</div><div class="u-email">${u.email}</div></div>
            </div>
          </td>
          <td><span class="badge ${u.role==='ADMIN'?'badge-admin':'badge-user'}">${u.role}</span></td>
          <td><span class="badge ${u.hasVoted?'badge-voted':'badge-pending'}">${u.hasVoted?'‚úÖ Voted':'‚è≥ Pending'}</span></td>
        </tr>`;
      }).join('');
    }

    function filterUsers() {
      const q = document.getElementById('userSearch').value.toLowerCase();
      renderUsers(allUsers.filter(u => (u.name||'').toLowerCase().includes(q) || (u.email||'').toLowerCase().includes(q)));
    }

    function confirmReset() {
      openModal('‚ö†Ô∏è Reset All Votes', 'This will clear ALL vote counts and allow all users to vote again. This CANNOT be undone.', doReset);
    }

    async function doReset() {
      closeModal();
      try {
        const res = await fetch('/api/admin/reset', { method: 'POST' });
        const d   = await res.json();
        showToast('‚úÖ '+(d.message||'Votes reset.'), 'success'); loadAll();
      } catch(e) { showToast('Network error.', 'error'); }
    }

    let _modalCallback = null;
    function openModal(title, msg, callback) {
      document.getElementById('modalTitle').innerHTML = title;
      document.getElementById('modalMsg').innerHTML   = msg;
      _modalCallback = callback;
      document.getElementById('confirmModal').classList.add('open');
    }
    function closeModal() { document.getElementById('confirmModal').classList.remove('open'); _modalCallback = null; }
    document.getElementById('modalConfirmBtn').onclick = () => { if (_modalCallback) _modalCallback(); };
    document.getElementById('confirmModal').addEventListener('click', e => { if (e.target === e.currentTarget) closeModal(); });

    function showToast(msg, type='info') {
      const t = document.getElementById('toast');
      t.textContent = msg; t.className = 'toast '+type+' show';
      clearTimeout(t._t); t._t = setTimeout(() => t.classList.remove('show'), 4500);
    }

    function logout() { localStorage.clear(); window.location = 'index.html'; }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    loadAll();
    setInterval(loadAll, 30000);
  </script>
</body>
</html>
