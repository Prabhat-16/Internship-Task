<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>VoteSecure ‚Äî Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <style>
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

      :root {
        --primary: #6366f1;
        --primary-light: #818cf8;
        --primary-dark: #4f46e5;
        --accent: #06b6d4;
        --accent2: #a855f7;
        --bg-deep: #060714;
        --border: rgba(255,255,255,0.08);
        --border-hover: rgba(99,102,241,0.5);
        --text: #f1f5f9;
        --text-muted: #94a3b8;
        --success: #10b981;
        --error: #ef4444;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-deep);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      /* ‚îÄ‚îÄ Canvas particle background ‚îÄ‚îÄ */
      #particles-canvas {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
      }

      /* ‚îÄ‚îÄ Gradient orbs ‚îÄ‚îÄ */
      .orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(100px);
        pointer-events: none;
        z-index: 1;
        animation-timing-function: ease-in-out;
        animation-iteration-count: infinite;
        animation-direction: alternate;
      }
      .orb-1 {
        width: 500px; height: 500px;
        background: radial-gradient(circle, rgba(99,102,241,0.25) 0%, transparent 70%);
        top: -150px; left: -150px;
        animation: orbFloat1 9s ease-in-out infinite;
      }
      .orb-2 {
        width: 400px; height: 400px;
        background: radial-gradient(circle, rgba(6,182,212,0.2) 0%, transparent 70%);
        bottom: -100px; right: -100px;
        animation: orbFloat2 11s ease-in-out infinite;
      }
      .orb-3 {
        width: 300px; height: 300px;
        background: radial-gradient(circle, rgba(168,85,247,0.15) 0%, transparent 70%);
        top: 40%; left: 60%;
        animation: orbFloat3 13s ease-in-out infinite;
      }
      @keyframes orbFloat1 { 0%,100%{transform:translate(0,0) scale(1)} 50%{transform:translate(50px,40px) scale(1.1)} }
      @keyframes orbFloat2 { 0%,100%{transform:translate(0,0) scale(1)} 50%{transform:translate(-40px,-50px) scale(1.1)} }
      @keyframes orbFloat3 { 0%,100%{transform:translate(0,0) scale(1)} 50%{transform:translate(-30px,30px) scale(0.9)} }

      /* ‚îÄ‚îÄ Grid overlay ‚îÄ‚îÄ */
      body::before {
        content: '';
        position: fixed;
        inset: 0;
        background-image:
          linear-gradient(rgba(255,255,255,0.018) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,0.018) 1px, transparent 1px);
        background-size: 44px 44px;
        z-index: 1;
        pointer-events: none;
      }

      /* ‚îÄ‚îÄ Container ‚îÄ‚îÄ */
      .container {
        position: relative;
        z-index: 10;
        width: 100%;
        max-width: 460px;
        padding: 24px;
        animation: slideUp 0.7s cubic-bezier(0.16, 1, 0.3, 1) both;
      }
      @keyframes slideUp {
        from { opacity: 0; transform: translateY(50px) scale(0.97); }
        to   { opacity: 1; transform: translateY(0) scale(1); }
      }

      /* ‚îÄ‚îÄ Brand ‚îÄ‚îÄ */
      .brand { text-align: center; margin-bottom: 36px; }
      .brand-icon-wrap {
        position: relative;
        display: inline-block;
        margin-bottom: 18px;
      }
      .brand-icon {
        width: 72px; height: 72px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border-radius: 22px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        box-shadow: 0 0 0 0 rgba(99,102,241,0.6);
        animation: iconPulseRing 2.5s ease-in-out infinite;
        position: relative;
        z-index: 2;
      }
      .brand-icon-ring {
        position: absolute;
        inset: -8px;
        border-radius: 28px;
        border: 2px solid rgba(99,102,241,0.3);
        animation: ringExpand 2.5s ease-in-out infinite;
      }
      .brand-icon-ring2 {
        position: absolute;
        inset: -16px;
        border-radius: 34px;
        border: 1px solid rgba(99,102,241,0.15);
        animation: ringExpand 2.5s ease-in-out infinite 0.4s;
      }
      @keyframes iconPulseRing {
        0%,100% { box-shadow: 0 0 30px rgba(99,102,241,0.4), 0 0 60px rgba(99,102,241,0.1); }
        50%      { box-shadow: 0 0 50px rgba(99,102,241,0.6), 0 0 100px rgba(6,182,212,0.2); }
      }
      @keyframes ringExpand {
        0%   { opacity: 1; transform: scale(1); }
        80%  { opacity: 0; transform: scale(1.3); }
        100% { opacity: 0; transform: scale(1.3); }
      }
      .brand h1 {
        font-size: 32px;
        font-weight: 900;
        letter-spacing: -1px;
        background: linear-gradient(135deg, #fff 0%, var(--primary-light) 50%, var(--accent) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 6px;
      }
      .brand p {
        font-size: 14px;
        color: var(--text-muted);
      }

      /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
      .card {
        background: rgba(255,255,255,0.03);
        backdrop-filter: blur(30px) saturate(180%);
        -webkit-backdrop-filter: blur(30px) saturate(180%);
        border: 1px solid var(--border);
        border-radius: 28px;
        padding: 40px;
        box-shadow:
          0 0 0 1px rgba(255,255,255,0.03) inset,
          0 20px 60px rgba(0,0,0,0.5),
          0 0 100px rgba(99,102,241,0.05);
        position: relative;
        overflow: hidden;
        transition: border-color 0.4s ease, box-shadow 0.4s ease;
      }
      .card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(99,102,241,0.6), rgba(6,182,212,0.4), transparent);
        opacity: 0.6;
      }
      .card:hover {
        border-color: rgba(99,102,241,0.2);
        box-shadow:
          0 0 0 1px rgba(255,255,255,0.05) inset,
          0 20px 60px rgba(0,0,0,0.5),
          0 0 120px rgba(99,102,241,0.1);
      }

      .card-header { margin-bottom: 30px; }
      .card-title {
        font-size: 22px;
        font-weight: 800;
        color: var(--text);
        letter-spacing: -0.5px;
        margin-bottom: 6px;
      }
      .card-sub { font-size: 14px; color: var(--text-muted); }

      /* ‚îÄ‚îÄ Fields ‚îÄ‚îÄ */
      .field { margin-bottom: 20px; }
      .field label {
        display: block;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 8px;
        letter-spacing: 0.8px;
        text-transform: uppercase;
      }
      .input-wrap { position: relative; }
      .input-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: var(--text-muted);
        pointer-events: none;
        transition: color 0.3s, transform 0.3s;
        z-index: 2;
      }
      .input-wrap:focus-within .input-icon {
        color: var(--primary-light);
        transform: translateY(-50%) scale(1.1);
      }
      .field input {
        width: 100%;
        padding: 14px 14px 14px 46px;
        background: rgba(255,255,255,0.04);
        border: 1px solid var(--border);
        border-radius: 14px;
        color: var(--text);
        font-size: 15px;
        font-family: "Inter", sans-serif;
        outline: none;
        transition: all 0.3s ease;
      }
      .field input::placeholder { color: rgba(148,163,184,0.4); }
      .field input:focus {
        border-color: var(--primary);
        background: rgba(99,102,241,0.07);
        box-shadow: 0 0 0 4px rgba(99,102,241,0.12), 0 0 20px rgba(99,102,241,0.08);
        transform: translateY(-1px);
      }
      .toggle-pw {
        position: absolute;
        right: 14px; top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        font-size: 16px;
        color: var(--text-muted);
        user-select: none;
        transition: all 0.2s;
        z-index: 2;
      }
      .toggle-pw:hover { color: var(--text); transform: translateY(-50%) scale(1.1); }

      /* ‚îÄ‚îÄ Button ‚îÄ‚îÄ */
      .btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 50%, #3730a3 100%);
        border: none;
        border-radius: 14px;
        color: #fff;
        font-size: 15px;
        font-weight: 700;
        font-family: "Inter", sans-serif;
        cursor: pointer;
        margin-top: 8px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 24px rgba(99,102,241,0.45), 0 0 0 1px rgba(255,255,255,0.08) inset;
        letter-spacing: 0.3px;
      }
      .btn::before {
        content: '';
        position: absolute;
        top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
        transition: left 0.6s ease;
      }
      .btn:hover::before { left: 100%; }
      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 40px rgba(99,102,241,0.6), 0 0 0 1px rgba(255,255,255,0.1) inset;
      }
      .btn:active { transform: translateY(-1px); }
      .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
      .btn-text { display: flex; align-items: center; justify-content: center; gap: 8px; }
      .spinner {
        display: none;
        width: 18px; height: 18px;
        border: 2px solid rgba(255,255,255,0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.7s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      /* Ripple effect */
      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255,255,255,0.25);
        transform: scale(0);
        animation: rippleAnim 0.6s ease-out;
        pointer-events: none;
        z-index: 0;
      }
      @keyframes rippleAnim {
        to { transform: scale(4); opacity: 0; }
      }

      /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
      .toast {
        margin-top: 18px;
        padding: 13px 16px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 500;
        display: none;
        align-items: center;
        gap: 10px;
        animation: toastIn 0.35s cubic-bezier(0.16,1,0.3,1);
      }
      @keyframes toastIn {
        from { opacity: 0; transform: translateY(-8px) scale(0.97); }
        to   { opacity: 1; transform: translateY(0) scale(1); }
      }
      .toast.error   { background: rgba(239,68,68,0.12);  border: 1px solid rgba(239,68,68,0.3);  color: #fca5a5; display: flex; }
      .toast.success { background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.3); color: #6ee7b7; display: flex; }

      /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
      .footer-link {
        text-align: center;
        margin-top: 28px;
        font-size: 14px;
        color: var(--text-muted);
      }
      .footer-link a {
        color: var(--primary-light);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
        background: linear-gradient(90deg, var(--primary-light), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .footer-link a:hover { opacity: 0.85; text-decoration: underline; }

      /* ‚îÄ‚îÄ Security badge ‚îÄ‚îÄ */
      .security-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-top: 22px;
        font-size: 12px;
        color: rgba(148,163,184,0.5);
      }
      .security-badge .sep { opacity: 0.3; }

      /* ‚îÄ‚îÄ Divider ‚îÄ‚îÄ */
      .divider {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 24px 0;
      }
      .divider-line { flex: 1; height: 1px; background: var(--border); }
      .divider-text { font-size: 12px; color: var(--text-muted); white-space: nowrap; }

      .forgot-link {
        text-align: right; margin-top: -6px; margin-bottom: 2px;
      }
      .forgot-link a {
        font-size: 12px; font-weight: 600; text-decoration: none;
        background: linear-gradient(90deg, var(--primary-light), var(--accent));
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        transition: opacity 0.2s;
      }
      .forgot-link a:hover { opacity: 0.75; }

      @media (max-width: 480px) {
        .card { padding: 28px 22px; }
        .container { padding: 16px; }
        .brand h1 { font-size: 26px; }
      }
    </style>
  </head>
  <body>
    <canvas id="particles-canvas"></canvas>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="container">
      <div class="brand">
        <div class="brand-icon-wrap">
          <div class="brand-icon-ring2"></div>
          <div class="brand-icon-ring"></div>
          <div class="brand-icon">üó≥Ô∏è</div>
        </div>
        <h1>VoteSecure</h1>
        <p>Trusted Digital Voting Platform</p>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Welcome back üëã</div>
          <div class="card-sub">Sign in to cast your vote securely</div>
        </div>

        <div class="field">
          <label for="email">Email Address</label>
          <div class="input-wrap">
            <input type="email" id="email" placeholder="you@example.com" autocomplete="email" />
            <span class="input-icon">‚úâÔ∏è</span>
          </div>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <div class="input-wrap">
            <input type="password" id="password" placeholder="Enter your password" autocomplete="current-password" />
            <span class="input-icon">üîí</span>
            <span class="toggle-pw" id="togglePw" title="Show/Hide password">üëÅÔ∏è</span>
          </div>
        </div>

        <div class="forgot-link">
          <a href="forgot-password.html">Forgot password?</a>
        </div>

        <button class="btn" id="loginBtn" onclick="login(this, event)">
          <span class="btn-text">
            <div class="spinner" id="spinner"></div>
            <span id="btnLabel">Sign In ‚Üí</span>
          </span>
        </button>

        <div class="toast" id="toast"></div>
      </div>

      <div class="footer-link">
        Don't have an account? <a href="register.html">Create one here ‚Üí</a>
      </div>

      <div class="security-badge">
        üîê End-to-end encrypted
        <span class="sep">¬∑</span>
        ‚úÖ One vote per person
        <span class="sep">¬∑</span>
        üõ°Ô∏è Tamper-proof
      </div>
    </div>

    <script>
      /* ‚îÄ‚îÄ Particle Canvas ‚îÄ‚îÄ */
      (function() {
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');
        let W, H, particles = [];

        function resize() {
          W = canvas.width = window.innerWidth;
          H = canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        function mkParticle() {
          return {
            x: Math.random() * W,
            y: Math.random() * H,
            r: Math.random() * 1.5 + 0.4,
            dx: (Math.random() - 0.5) * 0.3,
            dy: (Math.random() - 0.5) * 0.3,
            alpha: Math.random() * 0.5 + 0.1,
            color: Math.random() > 0.5
              ? `rgba(99,102,241,`
              : Math.random() > 0.5
                ? `rgba(6,182,212,`
                : `rgba(168,85,247,`
          };
        }

        for (let i = 0; i < 90; i++) particles.push(mkParticle());

        function draw() {
          ctx.clearRect(0, 0, W, H);
          particles.forEach(p => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color + p.alpha + ')';
            ctx.fill();
            p.x += p.dx; p.y += p.dy;
            if (p.x < 0 || p.x > W) p.dx *= -1;
            if (p.y < 0 || p.y > H) p.dy *= -1;
          });

          // Draw connections
          for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
              const dx = particles[i].x - particles[j].x;
              const dy = particles[i].y - particles[j].y;
              const dist = Math.sqrt(dx*dx + dy*dy);
              if (dist < 110) {
                ctx.beginPath();
                ctx.moveTo(particles[i].x, particles[i].y);
                ctx.lineTo(particles[j].x, particles[j].y);
                ctx.strokeStyle = `rgba(99,102,241,${(1 - dist/110) * 0.12})`;
                ctx.lineWidth = 0.6;
                ctx.stroke();
              }
            }
          }
          requestAnimationFrame(draw);
        }
        draw();
      })();

      /* ‚îÄ‚îÄ Ripple on button ‚îÄ‚îÄ */
      function addRipple(btn, e) {
        const rect = btn.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const ripple = document.createElement('span');
        ripple.className = 'ripple';
        ripple.style.cssText = `width:${size}px;height:${size}px;left:${e.clientX-rect.left-size/2}px;top:${e.clientY-rect.top-size/2}px`;
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      /* ‚îÄ‚îÄ Toggle password ‚îÄ‚îÄ */
      const toggler = document.getElementById('togglePw');
      const pwInput = document.getElementById('password');
      toggler.addEventListener('click', () => {
        const isText = pwInput.type === 'text';
        pwInput.type = isText ? 'password' : 'text';
        toggler.textContent = isText ? 'üëÅÔ∏è' : 'üôà';
      });

      document.addEventListener('keydown', e => { if (e.key === 'Enter') login(document.getElementById('loginBtn'), e); });

      function showToast(msg, type) {
        const t = document.getElementById('toast');
        t.textContent = (type === 'error' ? '‚õî ' : '‚úÖ ') + msg;
        t.className = 'toast ' + type;
        t.style.animation = 'none';
        void t.offsetWidth;
        t.style.animation = '';
      }

      function setLoading(on) {
        const btn = document.getElementById('loginBtn');
        const spinner = document.getElementById('spinner');
        const label = document.getElementById('btnLabel');
        btn.disabled = on;
        spinner.style.display = on ? 'block' : 'none';
        label.textContent = on ? 'Signing in‚Ä¶' : 'Sign In ‚Üí';
      }

      function login(btnEl, event) {
        if (event) addRipple(btnEl, event);
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        if (!email || !password) { showToast('Please fill in all fields.', 'error'); return; }
        setLoading(true);

        fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        })
          .then(async res => {
            const contentType = res.headers.get('content-type') || '';
            if (!contentType.includes('application/json')) throw new Error('Server error ‚Äî please make sure the app is fully started.');
            const data = await res.json();
            if (!res.ok) throw new Error(data.message || 'Invalid credentials.');
            if (!data.id) throw new Error('Invalid credentials.');
            localStorage.setItem('userId', data.id);
            localStorage.setItem('userName', data.name || 'Voter');
            localStorage.setItem('userRole', data.role || 'USER');
            showToast('Login successful! Redirecting‚Ä¶', 'success');
            const target = data.role === 'ADMIN' ? 'admin.html' : 'user.html';
            setTimeout(() => { window.location = target; }, 900);
          })
          .catch(err => {
            setLoading(false);
            showToast(err.message || 'Login failed. Please try again.', 'error');
          });
      }
    </script>
  </body>
</html>
